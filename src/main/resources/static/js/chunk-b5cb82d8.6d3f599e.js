(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-b5cb82d8"],{"14df":function(e,t,s){"use strict";s.r(t);var a=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",[s("el-container",[s("el-header",[e._v(" 上传实测数据 "),s("div",{staticStyle:{flex:"1"}},[s("el-button",{staticStyle:{margin:"0","border-radius":"100px"},attrs:{disabled:e.gettingMeasured},on:{click:e.handleGetMeasuredClick}},[s("i",{directives:[{name:"show",rawName:"v-show",value:e.gettingMeasured,expression:"gettingMeasured"}],staticClass:"el-icon-loading"}),e._v(" "+e._s(e.getMeasuredButtonText)+" ")])],1)]),s("el-main",[s("el-row",{attrs:{gutter:15}},[s("el-col",{attrs:{span:18}},[s("el-card",{directives:[{name:"show",rawName:"v-show",value:1===e.step,expression:"step===1"}],attrs:{shadow:"hover"}},[s("el-form",{attrs:{"label-width":"20%"}},[s("el-form-item",{attrs:{label:"水库名称"}},[s("el-select",{attrs:{placeholder:"请选择"},model:{value:e.selectedReservoir,callback:function(t){e.selectedReservoir=t},expression:"selectedReservoir"}},e._l(e.reservoirList,(function(t){return s("el-option",{key:t.id,attrs:{label:t.name,value:t.name}},[e._v(" "+e._s(t.name)+" ")])})),1)],1),s("el-form-item",{attrs:{label:"选择文件"}},[s("el-upload",{staticClass:"upload-drag-list",attrs:{drag:"",action:"",limit:1,"auto-upload":!1,"show-file-list":!0,"on-change":e.handleFileChanges,"on-remove":e.handleFileChanges,multiple:!1,"file-list":e.fileList}},[s("i",{staticClass:"el-icon-upload"}),s("div",{staticClass:"el-upload__text"},[e._v("将文件拖到此处，或"),s("em",[e._v("点击上传")])])])],1),s("el-button",{attrs:{disabled:e.stepOneClickNextDisable},on:{click:e.stepOneClickNext}},[e._v(" 下一步 ")])],1)],1),s("el-card",{directives:[{name:"show",rawName:"v-show",value:2===e.step,expression:"step===2"}],attrs:{shadow:"hover"}},[e._v(" 从文件中提取到以下数据： "),s("el-table",{attrs:{data:e.resultList,border:!0}},[s("el-table-column",{attrs:{prop:"siteName",label:"站名"}}),s("el-table-column",{attrs:{prop:"waterLevel",label:"水位/m"}}),s("el-table-column",{attrs:{prop:"measuredStorage",label:"蓄水量/亿m³"}}),s("el-table-column",{attrs:{prop:"date",label:"日期"}})],1),s("el-button",{attrs:{type:"success"},on:{click:e.stepTwoClickSave}},[e._v(" 确认并保存 ")]),s("el-button",{on:{click:e.stepTwoClickBack}},[e._v(" 上一步 ")])],1),s("el-card",{directives:[{name:"show",rawName:"v-show",value:3===e.step,expression:"step===3"}],attrs:{shadow:"hover"}},[s("i",{staticClass:"el-icon-success"}),e._v(" 数据已保存 "),s("el-button",{on:{click:e.stepThreeClickWatchData}},[e._v(" 查看数据 ")])],1)],1),s("el-col",{attrs:{span:6}},[s("el-card",{directives:[{name:"show",rawName:"v-show",value:e.step<4,expression:"step<4"}],attrs:{shadow:"hover"}},[s("el-steps",{attrs:{direction:"vertical",active:e.step-1}},[s("el-step",{attrs:{title:"上传文件",description:"选择目标水库，上传实测数据Excel文件"}}),s("el-step",{attrs:{title:"确认数据",description:"确认数据提取结果"}}),s("el-step",{attrs:{title:"上传完成"}})],1)],1)],1)],1)],1)],1),s("el-dialog",{attrs:{title:"成功获取实测数据",visible:e.getMeasuredResultVisitable},on:{"update:visible":function(t){e.getMeasuredResultVisitable=t}}},[s("div",{staticStyle:{"margin-left":"1em","margin-top":"-10px",color:"#868686","font-size":"15px"}},[e._v(" 从 "),s("a",{staticStyle:{color:"#0098d9","text-decoration":"none"},attrs:{href:"http://xxfb.mwr.cn/ssIndex.html?type=3",target:"_blank"}},[e._v(" 全国水雨情网站 ")]),e._v(" 获取到以下数据，并已保存至数据库。 ")]),s("el-table",{attrs:{data:e.resultList,border:!0}},[s("el-table-column",{attrs:{prop:"siteName",label:"站名"}}),s("el-table-column",{attrs:{prop:"waterLevel",label:"水位/m"}}),s("el-table-column",{attrs:{prop:"measuredStorage",label:"蓄水量/亿m³"}}),s("el-table-column",{attrs:{prop:"date",label:"日期"}})],1)],1)],1)},r=[],i={name:"uploadMeasuredLevel",data:function(){return{fileList:[],reservoirList:[],selectedReservoir:"",resultList:[],step:1,gettingMeasured:!1,getMeasuredResultVisitable:!1}},computed:{stepOneClickNextDisable:function(){return""===this.selectedReservoir||0===this.fileList.length},getMeasuredButtonText:function(){return this.gettingMeasured?"请稍等":"获取今日实测数据"}},methods:{handleFileChanges:function(e,t){this.fileList=t},stepOneClickNext:function(){var e=this,t=new FormData;t.append("reservoirName",this.selectedReservoir),t.append("measuredFile",this.fileList[0].raw),this.axios({url:"/api/upload/measured",method:"post",data:t,headers:{"Content-Type":"multipart/form-data;charset=utf-8"}}).then((function(t){if(200===t.status){e.resultList=t.data;for(var s=0;s<e.resultList.length;s++)e.resultList[s].date=new Date(parseInt(e.resultList[s].date)).toLocaleDateString();e.step++}}))},handleGetMeasuredClick:function(){var e=this;""!==this.selectedReservoir?(this.gettingMeasured=!0,this.axios.get("/api/data/getwaterlevel",{params:{rname:this.selectedReservoir}}).then((function(t){200===t.status?"success"===t.data?(e.$notify({title:"成功",message:"已成功获取实测记录",type:"success"}),e.axios.get("/api/data/getTodayWaterLevel",{params:{rname:e.selectedReservoir}}).then((function(t){e.resultList=t.data;for(var s=0;s<e.resultList.length;s++)e.resultList[s].date=new Date(parseInt(e.resultList[s].date)).toLocaleDateString();e.getMeasuredResultVisitable=!0}))):"duplicate"===t.data?e.$notify({title:"警告",message:"检测到系统中已有"+e.selectedReservoir+"于今日的实测记录，请先删除该记录后重试",type:"warning"}):"notFound"===t.data&&e.$notify({title:"错误",message:"无法获取实测记录，请检查水库名称与水文网中的是否一致",type:"error"}):e.$notify({title:"错误",message:"连接失败",type:"error"}),e.gettingMeasured=!1}))):this.$notify({title:"警告",message:"请先在“水库名称”中选择水库",type:"warning"})},stepTwoClickBack:function(){this.step--},stepTwoClickSave:function(){var e=this;this.axios.get("/api/upload/measured/save").then((function(t){200===t.status?e.step++:console.log("error")}))},stepThreeClickWatchData:function(){this.$router.push("/dm")}},mounted:function(){var e=this;this.axios.get("/api/reservoirInfo/reservoir").then((function(t){200===t.status?e.reservoirList=t.data:console.log("error")})),this.selectedReservoir=this.$store.getters.getReservoir}},l=i,o=(s("56f2"),s("2877")),n=Object(o["a"])(l,a,r,!1,null,"a1997d96",null);t["default"]=n.exports},"56f2":function(e,t,s){"use strict";var a=s("5b5e"),r=s.n(a);r.a},"5b5e":function(e,t,s){}}]);
//# sourceMappingURL=chunk-b5cb82d8.6d3f599e.js.map